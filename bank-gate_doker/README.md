# p2p-gate
Шлюз Bank-gate обеспечивает перевод с карты на карту через банк Тинькофф, резерв Бин-Банк
---


Перед сборкой билда необходимо отредактировать следуцющие переменные в файле .config

**CALL_BACK_PAY***=http://<имя хоста докера>:8226/pay/confirm

**ERROR_PAGE**  страница на которую будет переадресовываться пользователь при не успешной операции

**SUCCESS_PAGE** страница на которую будет переадресовываться пользователь при успешной операции

**RECEIVER_CARD** - карта на которую зачисляются деньги

**JWT_ISS**  - справочная информация для генерации JWT

**JWT_KEY** - ключ шифрования JWT в формате Base64

**UUID_NAMESPACE** ключ для генерации jti - уникальный ID JWT (в формате UUID5)  



Успешный ответ будет содержать переменную payid, в формате encrypted JWT, содержащую следующую информацию:

*{
  "jti": "5e2e5974-b647-5eb9-b1c4-26070dcea4af",
  "iat": 1571933200,
  "sub": "fixed",
  "iss": "ru.phone4pay",
  "pay_id": "123456",
  "sum": "100.0",
  "transaction_id": "868720704"
}*

Успешность проведение операции проверяется по JWT:

1. Валидная цифровая подпись

2. Совпадение номера операции (pay_id) и суммы операции (sum) c данными инициации операции

3. iat - timestamp

4. JTI формируется как UUID5(UUID_NAMESPACE, pay_id+iat)


**Запуск собранного билда :**

docker run -d  -p 8226:8226 <имя билда>

**8226** - http порт шлюза
  
Для тестирования работы шлюза можно использовать встроенную тестовую страницу

***http://<имя хоста докера>:8226/pay/page?payid=123456&sum=100&text=Test***

Обязательные параметры  :

**payid** - ID платежной операции, устанавливается для идентификации ответа после успешного/не успешного выполнения перевода

**sum** - Сумма операции в формате float  

**text** - Назначение платежа



